using Moq.Protected;
using Moq;
using JH_Reddit.Server.Controllers;

namespace JH_RedditTest
{
    [TestClass]
    public class UnitTest1
    {
        [TestMethod]
        public void TestMethod1()
        {
            var handlerMock = new Mock<HttpMessageHandler>(MockBehavior.Strict);

            HttpResponseMessage result = new HttpResponseMessage();
            result.Headers.Add("x-ratelimit-used", "3");
            result.Headers.Add("x-ratelimit-remaining", "312.0");
            result.Headers.Add("x-ratelimit-reset", "300");
            result.Content = new StringContent(json);

            handlerMock
                .Protected()
                .Setup<Task<HttpResponseMessage>>(
                    "SendAsync",
                    ItExpr.IsAny<HttpRequestMessage>(),
                    ItExpr.IsAny<CancellationToken>()
                )
                .ReturnsAsync(result)
                .Verifiable();

            var httpClient = new HttpClient(handlerMock.Object)
            {
                BaseAddress = new Uri("https://www.code4it.dev/")
            };

            var mockHttpClientFactory = new Mock<IHttpClientFactory>();

            mockHttpClientFactory.Setup(_ => _.CreateClient("redditOauthClient")).Returns(httpClient);

            var controller = new RedditDataController(mockHttpClientFactory.Object);
            var resp = controller.SubReddit(
                new JH_Reddit.Server.Models.SubReddit { 
                    Name="apple", 
                    Limits = new JH_Reddit.Server.Models.RedditLimits(),
                    Posts = []
                });
        }

        static string json = "{\"kind\": \"Listing\", \"data\": {\"after\": \"t3_1cso45i\", \"dist\": 3, \"modhash\": null, \"geo_filter\": null, \"children\": [{\"kind\": \"t3\", \"data\": {\"approved_at_utc\": null, \"subreddit\": \"apple\", \"selftext\": \"Welcome to the Daily Advice Thread for /r/Apple. This thread can be used to ask for technical advice regarding Apple software and hardware, to ask questions regarding the buying or selling of Apple products or to post other short questions.\\n\\nHave a question you need answered? Ask away! Please remember to adhere to our rules, which can be found in the sidebar.\\n\\nJoin our Discord and IRC chat rooms for support:\\n\\n* [Discord](https://discord.gg/apple)\\n* [IRC](https://kiwiirc.com/client/irc.snoonet.org/apple?nick=CHANGE_ME)\\n\\nNote: Comments are sorted by /new for your convenience.\\n\\n[Here is an archive](https://www.reddit.com/r/apple/search?q=author%3A%22AutoModerator%22+title%3A%22Daily+Advice+Thread%22+or+title%3A%22Daily+Tech+Support+Thread%22&amp;sort=new&amp;t=all) of all previous Daily Advice Threads. This is best viewed on a browser. If on mobile, type in the search bar \\\\[author:\\\"AutoModerator\\\" title:\\\"Daily Advice Thread\\\" or title:\\\"Daily Tech Support Thread\\\"\\\\] (without the brackets, and including the quotation marks around the titles and author.)\\n\\n**The Daily Advice Thread is posted each day at 06:00 AM EST (**[Click HERE for other timezones](https://www.wolframalpha.com/input/?i=6+AM+USA+EST)**) and then the old one is archived.** It is advised to wait for the new thread to post your question if this time is nearing for quickest answer time.\", \"author_fullname\": \"t2_6l4z3\", \"saved\": false, \"mod_reason_title\": null, \"gilded\": 0, \"clicked\": false, \"title\": \"Daily Advice Thread - May 15, 2024\", \"link_flair_richtext\": [{\"e\": \"text\", \"t\": \"Support Thread\"}], \"subreddit_name_prefixed\": \"r/apple\", \"hidden\": false, \"pwls\": 6, \"link_flair_css_class\": \"megathread\", \"downs\": 0, \"thumbnail_height\": null, \"top_awarded_type\": null, \"hide_score\": false, \"name\": \"t3_1csh2rj\", \"quarantine\": false, \"link_flair_text_color\": \"light\", \"upvote_ratio\": 0.63, \"author_flair_background_color\": null, \"subreddit_type\": \"public\", \"ups\": 2, \"total_awards_received\": 0, \"media_embed\": {}, \"thumbnail_width\": null, \"author_flair_template_id\": null, \"is_original_content\": false, \"user_reports\": [], \"secure_media\": null, \"is_reddit_media_domain\": false, \"is_meta\": false, \"category\": null, \"secure_media_embed\": {}, \"link_flair_text\": \"Support Thread\", \"can_mod_post\": false, \"score\": 2, \"approved_by\": null, \"is_created_from_ads_ui\": false, \"author_premium\": true, \"thumbnail\": \"self\", \"edited\": false, \"author_flair_css_class\": null, \"author_flair_richtext\": [], \"gildings\": {}, \"content_categories\": null, \"is_self\": true, \"mod_note\": null, \"created\": 1715767234.0, \"link_flair_type\": \"richtext\", \"wls\": 6, \"removed_by_category\": null, \"banned_by\": null, \"author_flair_type\": \"text\", \"domain\": \"self.apple\", \"allow_live_comments\": false, \"selftext_html\": \"&lt;!-- SC_OFF --&gt;&lt;div class=\\\"md\\\"&gt;&lt;p&gt;Welcome to the Daily Advice Thread for &lt;a href=\\\"/r/Apple\\\"&gt;/r/Apple&lt;/a&gt;. This thread can be used to ask for technical advice regarding Apple software and hardware, to ask questions regarding the buying or selling of Apple products or to post other short questions.&lt;/p&gt;\\n\\n&lt;p&gt;Have a question you need answered? Ask away! Please remember to adhere to our rules, which can be found in the sidebar.&lt;/p&gt;\\n\\n&lt;p&gt;Join our Discord and IRC chat rooms for support:&lt;/p&gt;\\n\\n&lt;ul&gt;\\n&lt;li&gt;&lt;a href=\\\"https://discord.gg/apple\\\"&gt;Discord&lt;/a&gt;&lt;/li&gt;\\n&lt;li&gt;&lt;a href=\\\"https://kiwiirc.com/client/irc.snoonet.org/apple?nick=CHANGE_ME\\\"&gt;IRC&lt;/a&gt;&lt;/li&gt;\\n&lt;/ul&gt;\\n\\n&lt;p&gt;Note: Comments are sorted by /new for your convenience.&lt;/p&gt;\\n\\n&lt;p&gt;&lt;a href=\\\"https://www.reddit.com/r/apple/search?q=author%3A%22AutoModerator%22+title%3A%22Daily+Advice+Thread%22+or+title%3A%22Daily+Tech+Support+Thread%22&amp;amp;sort=new&amp;amp;t=all\\\"&gt;Here is an archive&lt;/a&gt; of all previous Daily Advice Threads. This is best viewed on a browser. If on mobile, type in the search bar [author:&amp;quot;AutoModerator&amp;quot; title:&amp;quot;Daily Advice Thread&amp;quot; or title:&amp;quot;Daily Tech Support Thread&amp;quot;] (without the brackets, and including the quotation marks around the titles and author.)&lt;/p&gt;\\n\\n&lt;p&gt;&lt;strong&gt;The Daily Advice Thread is posted each day at 06:00 AM EST (&lt;/strong&gt;&lt;a href=\\\"https://www.wolframalpha.com/input/?i=6+AM+USA+EST\\\"&gt;Click HERE for other timezones&lt;/a&gt;&lt;strong&gt;) and then the old one is archived.&lt;/strong&gt; It is advised to wait for the new thread to post your question if this time is nearing for quickest answer time.&lt;/p&gt;\\n&lt;/div&gt;&lt;!-- SC_ON --&gt;\", \"likes\": null, \"suggested_sort\": \"new\", \"banned_at_utc\": null, \"view_count\": null, \"archived\": false, \"no_follow\": false, \"is_crosspostable\": true, \"pinned\": false, \"over_18\": false, \"all_awardings\": [], \"awarders\": [], \"media_only\": false, \"link_flair_template_id\": \"c2a1fcec-af92-11eb-9b65-0e0f3ca038eb\", \"can_gild\": false, \"spoiler\": false, \"locked\": false, \"author_flair_text\": null, \"treatment_tags\": [], \"visited\": false, \"removed_by\": null, \"num_reports\": null, \"distinguished\": null, \"subreddit_id\": \"t5_2qh1f\", \"author_is_blocked\": false, \"mod_reason_by\": null, \"removal_reason\": null, \"link_flair_background_color\": \"#5a74cc\", \"id\": \"1csh2rj\", \"is_robot_indexable\": true, \"report_reasons\": null, \"author\": \"AutoModerator\", \"discussion_type\": null, \"num_comments\": 44, \"send_replies\": false, \"whitelist_status\": \"all_ads\", \"contest_mode\": false, \"mod_reports\": [], \"author_patreon_flair\": false, \"author_flair_text_color\": null, \"permalink\": \"/r/apple/comments/1csh2rj/daily_advice_thread_may_15_2024/\", \"parent_whitelist_status\": \"all_ads\", \"stickied\": true, \"url\": \"https://www.reddit.com/r/apple/comments/1csh2rj/daily_advice_thread_may_15_2024/\", \"subreddit_subscribers\": 5002113, \"created_utc\": 1715767234.0, \"num_crossposts\": 0, \"media\": null, \"is_video\": false}}, {\"kind\": \"t3\", \"data\": {\"approved_at_utc\": null, \"subreddit\": \"apple\", \"selftext\": \"\", \"author_fullname\": \"t2_35pvly6b\", \"saved\": false, \"mod_reason_title\": null, \"gilded\": 0, \"clicked\": false, \"title\": \"Troubling iOS 17.5 Bug Reportedly Resurfacing Old Deleted Photos\", \"link_flair_richtext\": [{\"e\": \"text\", \"t\": \"iOS\"}], \"subreddit_name_prefixed\": \"r/apple\", \"hidden\": false, \"pwls\": 6, \"link_flair_css_class\": \"user\", \"downs\": 0, \"thumbnail_height\": 78, \"top_awarded_type\": null, \"hide_score\": false, \"name\": \"t3_1csk9v1\", \"quarantine\": false, \"link_flair_text_color\": \"light\", \"upvote_ratio\": 0.95, \"author_flair_background_color\": null, \"ups\": 657, \"total_awards_received\": 0, \"media_embed\": {}, \"thumbnail_width\": 140, \"author_flair_template_id\": null, \"is_original_content\": false, \"user_reports\": [], \"secure_media\": null, \"is_reddit_media_domain\": false, \"is_meta\": false, \"category\": null, \"secure_media_embed\": {}, \"link_flair_text\": \"iOS\", \"can_mod_post\": false, \"score\": 657, \"approved_by\": null, \"is_created_from_ads_ui\": false, \"author_premium\": false, \"thumbnail\": \"https://b.thumbs.redditmedia.com/fOOm5bENRRVf6H-lGB4JEtoLo-bORW4C892xp1Aghyg.jpg\", \"edited\": false, \"author_flair_css_class\": null, \"author_flair_richtext\": [], \"gildings\": {}, \"post_hint\": \"link\", \"content_categories\": null, \"is_self\": false, \"subreddit_type\": \"public\", \"created\": 1715778162.0, \"link_flair_type\": \"richtext\", \"wls\": 6, \"removed_by_category\": null, \"banned_by\": null, \"author_flair_type\": \"text\", \"domain\": \"macrumors.com\", \"allow_live_comments\": false, \"selftext_html\": null, \"likes\": null, \"suggested_sort\": null, \"banned_at_utc\": null, \"url_overridden_by_dest\": \"https://www.macrumors.com/2024/05/15/ios-17-5-bug-deleted-photos-reappear/\", \"view_count\": null, \"archived\": false, \"no_follow\": false, \"is_crosspostable\": true, \"pinned\": false, \"over_18\": false, \"preview\": {\"images\": [{\"source\": {\"url\": \"https://external-preview.redd.it/o53KZQqpq_Je2DvqDqI1CIO9aTjPGTwKZgoULZz81WI.jpg?auto=webp&amp;s=92e4f1bfcf5900c9276ed9d05e7151c42aaffaaa\", \"width\": 2500, \"height\": 1406}, \"resolutions\": [{\"url\": \"https://external-preview.redd.it/o53KZQqpq_Je2DvqDqI1CIO9aTjPGTwKZgoULZz81WI.jpg?width=108&amp;crop=smart&amp;auto=webp&amp;s=bf91c4d0dff9d5e6ba0310ff3293c58b3b7bf27c\", \"width\": 108, \"height\": 60}, {\"url\": \"https://external-preview.redd.it/o53KZQqpq_Je2DvqDqI1CIO9aTjPGTwKZgoULZz81WI.jpg?width=216&amp;crop=smart&amp;auto=webp&amp;s=cb84b9b59ea95a3d282f20c33c9a6e87f9140e64\", \"width\": 216, \"height\": 121}, {\"url\": \"https://external-preview.redd.it/o53KZQqpq_Je2DvqDqI1CIO9aTjPGTwKZgoULZz81WI.jpg?width=320&amp;crop=smart&amp;auto=webp&amp;s=1d07181a5657c3640b5eedb954531799239f7617\", \"width\": 320, \"height\": 179}, {\"url\": \"https://external-preview.redd.it/o53KZQqpq_Je2DvqDqI1CIO9aTjPGTwKZgoULZz81WI.jpg?width=640&amp;crop=smart&amp;auto=webp&amp;s=9bcae6c6f0e652fda236642c7fc61d7d8356260f\", \"width\": 640, \"height\": 359}, {\"url\": \"https://external-preview.redd.it/o53KZQqpq_Je2DvqDqI1CIO9aTjPGTwKZgoULZz81WI.jpg?width=960&amp;crop=smart&amp;auto=webp&amp;s=856a70db0c24b9e97ba669781b638071b1616f23\", \"width\": 960, \"height\": 539}, {\"url\": \"https://external-preview.redd.it/o53KZQqpq_Je2DvqDqI1CIO9aTjPGTwKZgoULZz81WI.jpg?width=1080&amp;crop=smart&amp;auto=webp&amp;s=e9534a0db92f1cdb85eaed58561be0aaa56f68ea\", \"width\": 1080, \"height\": 607}], \"variants\": {}, \"id\": \"MEAnY_lK_xWIXwENdAgOq7M-BJesVeQ3dDvISZyZGJw\"}], \"enabled\": false}, \"all_awardings\": [], \"awarders\": [], \"media_only\": false, \"link_flair_template_id\": \"e9b1d532-5701-11e9-87f1-0edf28c73d02\", \"can_gild\": false, \"spoiler\": false, \"locked\": false, \"author_flair_text\": null, \"treatment_tags\": [], \"visited\": false, \"removed_by\": null, \"mod_note\": null, \"distinguished\": null, \"subreddit_id\": \"t5_2qh1f\", \"author_is_blocked\": false, \"mod_reason_by\": null, \"num_reports\": null, \"removal_reason\": null, \"link_flair_background_color\": \"#f4a221\", \"id\": \"1csk9v1\", \"is_robot_indexable\": true, \"report_reasons\": null, \"author\": \"ifallupthestairsnok\", \"discussion_type\": null, \"num_comments\": 195, \"send_replies\": true, \"whitelist_status\": \"all_ads\", \"contest_mode\": false, \"mod_reports\": [], \"author_patreon_flair\": false, \"author_flair_text_color\": null, \"permalink\": \"/r/apple/comments/1csk9v1/troubling_ios_175_bug_reportedly_resurfacing_old/\", \"parent_whitelist_status\": \"all_ads\", \"stickied\": false, \"url\": \"https://www.macrumors.com/2024/05/15/ios-17-5-bug-deleted-photos-reappear/\", \"subreddit_subscribers\": 5002113, \"created_utc\": 1715778162.0, \"num_crossposts\": 0, \"media\": null, \"is_video\": false}}, {\"kind\": \"t3\", \"data\": {\"approved_at_utc\": null, \"subreddit\": \"apple\", \"selftext\": \"Ppsspp is now available in the App Store \", \"author_fullname\": \"t2_706tth9u\", \"saved\": false, \"mod_reason_title\": null, \"gilded\": 0, \"clicked\": false, \"title\": \"Ppsspp now available in the App Store \", \"link_flair_richtext\": [{\"e\": \"text\", \"t\": \"iPhone\"}], \"subreddit_name_prefixed\": \"r/apple\", \"hidden\": false, \"pwls\": 6, \"link_flair_css_class\": \"user\", \"downs\": 0, \"thumbnail_height\": 73, \"top_awarded_type\": null, \"hide_score\": false, \"name\": \"t3_1cso45i\", \"quarantine\": false, \"link_flair_text_color\": \"light\", \"upvote_ratio\": 0.95, \"author_flair_background_color\": null, \"ups\": 329, \"total_awards_received\": 0, \"media_embed\": {}, \"thumbnail_width\": 140, \"author_flair_template_id\": null, \"is_original_content\": false, \"user_reports\": [], \"secure_media\": null, \"is_reddit_media_domain\": false, \"is_meta\": false, \"category\": null, \"secure_media_embed\": {}, \"link_flair_text\": \"iPhone\", \"can_mod_post\": false, \"score\": 329, \"approved_by\": null, \"is_created_from_ads_ui\": false, \"author_premium\": false, \"thumbnail\": \"https://b.thumbs.redditmedia.com/AolhdzBeHQ-sLzAgeTbXvfGLmb9b8r7koSUE3V_UWhk.jpg\", \"edited\": false, \"author_flair_css_class\": null, \"author_flair_richtext\": [], \"gildings\": {}, \"post_hint\": \"link\", \"content_categories\": null, \"is_self\": false, \"subreddit_type\": \"public\", \"created\": 1715788181.0, \"link_flair_type\": \"richtext\", \"wls\": 6, \"removed_by_category\": null, \"banned_by\": null, \"author_flair_type\": \"text\", \"domain\": \"apps.apple.com\", \"allow_live_comments\": false, \"selftext_html\": \"&lt;!-- SC_OFF --&gt;&lt;div class=\\\"md\\\"&gt;&lt;p&gt;Ppsspp is now available in the App Store &lt;/p&gt;\\n&lt;/div&gt;&lt;!-- SC_ON --&gt;\", \"likes\": null, \"suggested_sort\": null, \"banned_at_utc\": null, \"url_overridden_by_dest\": \"https://apps.apple.com/ca/app/ppsspp-psp-emulator/id6496972903\", \"view_count\": null, \"archived\": false, \"no_follow\": false, \"is_crosspostable\": true, \"pinned\": false, \"over_18\": false, \"preview\": {\"images\": [{\"source\": {\"url\": \"https://external-preview.redd.it/V8hzf-8N9bbz9iyIYp8WWwT7vuudSYvhnXxn_IoY-PY.jpg?auto=webp&amp;s=4883244407016b2e2dbf52aa5cf6fbb71e93445f\", \"width\": 1200, \"height\": 630}, \"resolutions\": [{\"url\": \"https://external-preview.redd.it/V8hzf-8N9bbz9iyIYp8WWwT7vuudSYvhnXxn_IoY-PY.jpg?width=108&amp;crop=smart&amp;auto=webp&amp;s=7aa883a20f852e044f3eb7346a4d96868f03935b\", \"width\": 108, \"height\": 56}, {\"url\": \"https://external-preview.redd.it/V8hzf-8N9bbz9iyIYp8WWwT7vuudSYvhnXxn_IoY-PY.jpg?width=216&amp;crop=smart&amp;auto=webp&amp;s=5431ac26676eb6c87f8c86ccb92998461e73148f\", \"width\": 216, \"height\": 113}, {\"url\": \"https://external-preview.redd.it/V8hzf-8N9bbz9iyIYp8WWwT7vuudSYvhnXxn_IoY-PY.jpg?width=320&amp;crop=smart&amp;auto=webp&amp;s=de5a674e55a5972f50f0c2c2eafdf48cf1aa1625\", \"width\": 320, \"height\": 168}, {\"url\": \"https://external-preview.redd.it/V8hzf-8N9bbz9iyIYp8WWwT7vuudSYvhnXxn_IoY-PY.jpg?width=640&amp;crop=smart&amp;auto=webp&amp;s=527366b1292760d535f52239b7a244b5802c736e\", \"width\": 640, \"height\": 336}, {\"url\": \"https://external-preview.redd.it/V8hzf-8N9bbz9iyIYp8WWwT7vuudSYvhnXxn_IoY-PY.jpg?width=960&amp;crop=smart&amp;auto=webp&amp;s=a2d19b527de0c9951b36a6488c0fae41f7bfe02f\", \"width\": 960, \"height\": 504}, {\"url\": \"https://external-preview.redd.it/V8hzf-8N9bbz9iyIYp8WWwT7vuudSYvhnXxn_IoY-PY.jpg?width=1080&amp;crop=smart&amp;auto=webp&amp;s=b79c46f9e0d09a9b89f8d15c824ec9703db02c0f\", \"width\": 1080, \"height\": 567}], \"variants\": {}, \"id\": \"OqdiIHFL3xyZY17k81IULN_TzhOjIuPjZlEcHgeB8Nc\"}], \"enabled\": false}, \"all_awardings\": [], \"awarders\": [], \"media_only\": false, \"link_flair_template_id\": \"cf1ba144-5701-11e9-bb30-0e88b6a1dfbc\", \"can_gild\": false, \"spoiler\": false, \"locked\": false, \"author_flair_text\": null, \"treatment_tags\": [], \"visited\": false, \"removed_by\": null, \"mod_note\": null, \"distinguished\": null, \"subreddit_id\": \"t5_2qh1f\", \"author_is_blocked\": false, \"mod_reason_by\": null, \"num_reports\": null, \"removal_reason\": null, \"link_flair_background_color\": \"#314c57\", \"id\": \"1cso45i\", \"is_robot_indexable\": true, \"report_reasons\": null, \"author\": \"Flowtraxwolf\", \"discussion_type\": null, \"num_comments\": 84, \"send_replies\": true, \"whitelist_status\": \"all_ads\", \"contest_mode\": false, \"mod_reports\": [], \"author_patreon_flair\": false, \"author_flair_text_color\": null, \"permalink\": \"/r/apple/comments/1cso45i/ppsspp_now_available_in_the_app_store/\", \"parent_whitelist_status\": \"all_ads\", \"stickied\": false, \"url\": \"https://apps.apple.com/ca/app/ppsspp-psp-emulator/id6496972903\", \"subreddit_subscribers\": 5002113, \"created_utc\": 1715788181.0, \"num_crossposts\": 1, \"media\": null, \"is_video\": false}}], \"before\": null}}";
    }
}